CREATE TABLE product_quiz
(
product_id INTEGER NOT NULL,
product_code VARCHAR(8) NOT NULL,
price INTEGER NOT NULL
);

INSERT INTO product_quiz VALUES (1, 'A1000011', 10000);
INSERT INTO product_quiz VALUES (2, 'A1000045', 9000);
INSERT INTO product_quiz VALUES (3, 'C3000002', 22000);
INSERT INTO product_quiz VALUES (4, 'C3000006', 15000);
INSERT INTO product_quiz VALUES (5, 'C3000010', 30000);
INSERT INTO product_quiz VALUES (6, 'K1000023', 17000);

--0~9999
--10000~19999
--20000~29999
--30000~39999

--1. 단순 계산

SELECT 0 PRICE_GROUP, COUNT(*) PRODUCTS
FROM PRODUCT_QUIZ
WHERE PRICE BETWEEN 0 AND 9999
UNION ALL
SELECT 10000, COUNT(*)
FROM PRODUCT_QUIZ
WHERE PRICE BETWEEN 10000 AND 19999
UNION ALL
SELECT 20000, COUNT(*)
FROM PRODUCT_QUIZ
WHERE PRICE BETWEEN 20000 AND 29999
UNION ALL
SELECT 30000, COUNT(*)
FROM PRODUCT_QUIZ
WHERE PRICE BETWEEN 30000 AND 39999;

--2. GROUP BY 로 묶기

--만의 자릿수 로 계산
SELECT TRUNC(PRICE/10000), PRICE/10000 --TRUNC 소수점을 다 버린다.
FROM PRODUCT_QUIZ;

SELECT TRUNC(PRICE/10000)*10000 price_group, COUNT(*) products
FROM PRODUCT_QUIZ
GROUP BY TRUNC(PRICE/10000)
ORDER BY price_group;

SELECT CASE
            WHEN PRICE BETWEEN 0 AND 9999 THEN 0
            WHEN PRICE BETWEEN 10000 AND 19999 THEN 10000
            WHEN PRICE BETWEEN 20000 AND 29999 THEN 20000
            WHEN PRICE BETWEEN 30000 AND 39999 THEN 30000
            END PRICE_GROUP,
            COUNT(*)
FROM PRODUCT_QUIZ
GROUP BY CASE
            WHEN PRICE BETWEEN 0 AND 9999 THEN 0
            WHEN PRICE BETWEEN 10000 AND 19999 THEN 10000
            WHEN PRICE BETWEEN 20000 AND 29999 THEN 20000
            WHEN PRICE BETWEEN 30000 AND 39999 THEN 30000
            END
ORDER BY PRICE_GROUP;

--3. GROUP BY, SUBQUERY 를 쓰는법

SELECT PRICE PRICE_GROUP, COUNT(*) PRODUCTS
FROM   (SELECT PRODUCT_ID, PRODUCT_CODE, TRUNC(PRICE/10000)*10000 PRICE 
        FROM PRODUCT_QUIZ)
GROUP BY PRICE
ORDER BY PRICE
;


SELECT PRICE_GROUP*10000 PRICE_GROUP, COUNT(*) PRODUCTS
FROM   (SELECT PRODUCT_ID, PRODUCT_CODE, TRUNC(PRICE/10000)PRICE_GROUP
        FROM PRODUCT_QUIZ)
GROUP BY PRICE_GROUP
ORDER BY PRICE_GROUP
;

--TRUNC로 소수점 버리고 만의 자리로 그룹지어서 보여주는 방식
SELECT PRICE PRICE_GROUP, COUNT(*) PRODUCTS
FROM   (SELECT TRUNC(PRICE/10000)*10000 PRICE
        FROM PRODUCT_QUIZ)
GROUP BY PRICE
ORDER BY PRICE
;